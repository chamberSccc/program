<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>澹泊商贸购物商城</title>
  <link href="../css/base.css" type="text/css" rel="stylesheet" /> 
  <link href="../css/main.css" type="text/css" rel="stylesheet" /> 
  <link href="../dist/bootstrap/css/bootstrap.min.css" rel="stylesheet" /> 
  <script src="../js/jquery.js"></script> 
    <script src="../dist/bootstrap/js/bootstrap.min.js"></script> 
     <script src="../js/fly.js"></script>
     <script src="../js/requestAnimationFrame.js"></script> 
  <script src="../js/pintuer.js"></script> 
</head>
<body>
<nav id="nav-index" class="clearfix">
	<section class="container">
        <a href="#" class="fl home">澹泊商贸</a>
        <a href="#" class="fr button" data-num="0"><i id="end" class="glyphicon glyphicon-align-justify"></i></a>
        <div style="position:fixed; top:1px; right:35px; z-index:10000; width:1px; height:52px; line-height:52px; font-size:20px; text-align:center; color:#fff; background:#b1d8ee; display:none" id="msg">已成功加入购物车！</div> 
    </section>
</nav>
	<section>
        <a href="#"><img src="../images/ad.png" class="img-responsive"></a>
    </section>

<!--main-->
<section id="main" class="container mt10">
	<section class="row">
    	<section class="col-sm-3 sidebar clearfix">               	
            <img src="../images/LOGO.jpg" class="img-responsive">
        	<dl class="sidebar-cp">
            	<dt class="clearfix">
                	<span class="fl">产品类别</span>
                    <i class="fr glyphicon glyphicon-list"></i>
                </dt>
                <section>
                    <dd><a href="shop.html">茶专区</a></dd>
                    <dd><a href="shophealth.html">保健品专区</a></dd>
                    <dd><a href="shopthird.html">特色专区</a></dd>
                </section>
            </dl>
        </section>
    	<section class="col-sm-9">
            <ul class="prolist">
            	<li id="li1">
                	<a>
                        <img   class="img-responsive">
                         <div id="content" class="row-fluid">
						 	<div class="col-md-7">
						 		<p id="goodsname1"></p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span style="text-decoration:line-through;" class="price" id="goodsprice1"></span><span>&nbsp;&nbsp;&nbsp;&nbsp会员价</span><span class="vipprice"  style="color: red" id="vipprice1"></span>
    					</div>
                        
                    </a>
                </li>
            	<li id="li2">
                	<a>
                        <img   class="img-responsive">
                         <div id="content" class="row-fluid">
						 	<div class="col-md-7">
						 		<p id="goodsname2"></p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span style="text-decoration:line-through;" class="price" id="goodsprice2"></span><span>&nbsp;&nbsp;&nbsp;&nbsp会员价</span><span class="vipprice" style="color: red" id="vipprice2"></span>
    					</div>
                        
                    </a>
                </li>
            	<li id="li3">
                	<a >
                        <img   class="img-responsive">
                         <div id="content" class="row-fluid">
						 	<div class="col-md-7">
						 		<p id="goodsname3"></p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span style="text-decoration:line-through;" class="price" id="goodsprice3"></span><span>&nbsp;&nbsp;&nbsp;&nbsp会员价</span><span class="vipprice"  style="color: red" id="vipprice3"></span>
    					</div>
                        
                    </a>
                </li>
            	<li id="li4">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li5">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li6">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li7">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li8">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-12">
	    					<span style="text-decoration:line-through;">2850</span><span>&nbsp;&nbsp;&nbsp;&nbsp会员价</span><span>2222</span>
    					</div>
                    </a>
                </li>
            	<li id="li9">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li10">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 		<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li11">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li12">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
<!--
            	<li id="li13">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li14">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li15">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
            	<li id="li16">
                	<a >
                        <img  src="../images/LOGO.jpg" class="img-responsive">
                        <div id="content" class="row-fluid">
						 	<div class="col-md-5">
						 		<p>商洛茶</p>
						 	</div>
						 	<div class="col-md-3">
						 	<button type="button" style="margin-left: 41%"  id="shopCart-btn" class="btn btn-info btn-xs">加入购物车</button>
						 	</div>
    					</div>
    					<div class="col-md-9">
	    					<span>价格</span><span>2850</span>
    					</div>
                    </a>
                </li>
-->
            </ul>
        </section>
    </section>
</section>
<!--/main-->
<script type="text/javascript">
$(function() {
    var offset = $("#end").offset();
    //点击加入购物车效果
    $('.btn-info').on('click',
    function() {
        var addcar = $(this);
        var img = addcar.parent().parent().parent().find('img').attr('src');
        var flyer = $('<img class="u-flyer" width="100" height="100" src="' + img + '">');
        flyer.fly({
            start: {
                left: event.pageX,
                //开始位置（必填）#fly元素会被设置成position: fixed 
                top: event.pageY //开始位置（必填） 
            },
            end: {
                left: offset.left + 10,
                //结束位置（必填） 
                top: offset.top + 10,
                //结束位置（必填） 
                width: 0,
                //结束时宽度 
                height: 0 //结束时高度 
            },
            onEnd: function() { //结束回调                 
                this.destory(); //移除dom 
            }
        });
        //加入购物车的商品插入数据库操作,状态为未购买
        var parentObj = $(this).parent().parent().parent();
        var priceObject = parentObj.find("span.price");
        var goodsname = parentObj.find("p").html();
        var price = priceObject.html().substring(1);
        $('.btn-info').attr("disabled", "disabled");
        var data = {
            "goodsname": goodsname,
            "price": price,
            "state": "未购买"
        };
        var requestURL = "../../DanboBusiness/shop/addShop";
        $.ajax({
            type: "POST",
            url: requestURL,
            data: JSON.stringify(data),
            //必须转成JSON进行传递，否则会报code 117错误
            cache: false,
            dataType: "json",
            //后台返回值类型
            contentType: "application/json",
            success: function(resultData, textStatus) {
                if (resultData.message == 'success') {
	                $("#msg").show().animate({
                    width: '250px'
                	},200).fadeOut(1000); //提示信息 
                    $('.btn-info').removeAttr("disabled");
                } else {
                    alert("请您登录");
                    $('.btn-info').removeAttr("disabled");
                }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert(textStatus);
                $('.btn-info').removeAttr("disabled");
            }
        });
    });
});
var srcurl = '';
//页面开始从数据库加载商品信息
$(document).ready(function() {
    var requestURL = "../../DanboBusiness/shop/getGoodsInfo/first";
    $.ajax({
        type: "GET",
        url: requestURL,
        async: false,
        cache: false,
        success: function(resultData) {
            if (resultData == null) {
	            alert("页面加载失败");
            } else {
	            var json = resultData.goodsInfo;
	            var jsonlength = json.length;
	            var tempi = 0;
				for(var i=0;i<jsonlength;i++){
					var liname = "li"+ (i+1).toString();
					var liparent = $("#"+liname)
					liparent.find("img").attr("src",json[i].url);
					//liparent.find("img").attr("src",(json[i].url==null)?json[i].url:" ");
					liparent.find("#vipprice"+(i+1).toString()).html(json[i].vipprice);
					liparent.find("#goodsprice"+(i+1).toString()).html("￥"+json[i].goodsprice);
					liparent.find("#goodsname"+(i+1).toString()).html(json[i].goodsname);
					tempi = i+1;
				}
				for(var j=tempi;j<16;j++){
					var liname = "li"+ (j+1).toString();
					var liparent = $("#"+liname)
					liparent.hide();
				}
            }
        }
    });
});
//点击图片,打开商品细节时,
$(function() {
	$('img').on('click',function() {
		var url = "detail.html?url="+$(this).attr("src");
		window.open(url);
	});
});
</script>
</body>
</html>